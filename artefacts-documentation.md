# Simulation Artefacts and Execution Guide

This document outlines the various output files generated by the simulation runs and details the new, unified methods for running simulations.

## 1. How to Run Simulations

The project has been refactored to provide two primary, user-friendly entry points for running simulations: a powerful Command-Line Interface (`cli.py`) and an interactive Web Application (`run.py`).

### Method 1: Command-Line Interface (`cli.py`)

The `cli.py` script is the main entry point for all scripted and automated simulation runs. It provides a clean, subcommand-based interface for executing the different simulation modes.

**Available Commands:**

*   #### `python cli.py triangle`
    *   **Purpose**: Runs the full, high-fidelity "Tehran Triangle" mission scenario. This is the **primary command** for generating official mission data.
    *   **Usage**:
        ```bash
        # Run with default configuration and a new timestamped output directory
        python cli.py triangle

        # Specify a custom output directory
        python cli.py triangle --output-dir artefacts/my_custom_run

        # Specify a custom configuration file
        python cli.py triangle --config config/my_special_config.json
        ```

*   #### `python cli.py debug`
    *   **Purpose**: Runs a debug version of the triangle simulation. This command produces the same artefacts as `triangle` but adds verbose, structured logging to `debug.txt` for development and troubleshooting.
    *   **Usage**:
        ```bash
        # Run debug with default configuration
        python cli.py debug
        ```

*   #### `python cli.py stub`
    *   **Purpose**: Runs a lightweight "stub" simulation. It quickly generates placeholder plots and metadata to verify that the basic output interfaces are working, without running the full numerical simulation.
    *   **Usage**:
        ```bash
        # Run the stub simulation
        python cli.py stub --output-dir artefacts/stub_run
        ```

### Method 2: Web Application (`run.py`)

For interactive use, the project provides a web interface.

*   **Purpose**: To launch a FastAPI web server that allows you to run simulations and view results through your web browser.
*   **Usage**:
    ```bash
    python run.py
    ```
    After running the command, you can access the interface at `http://127.0.0.1:8000`.

### Method 3: `make` Commands (Shortcuts)

The `Makefile` provides convenient shortcuts for the most common CLI commands.

*   `make triangle`: A shortcut for `python cli.py triangle`.
*   `make simulate`: A shortcut for `python cli.py stub`.

---

## 2. Generated Artefacts

The following files are generated in a timestamped output directory (e.g., `artefacts/triangle/run_YYYYMMDD_HHMMZ/`) when using the `cli.py triangle` or `cli.py debug` commands.

### CSV Files

*   **`positions_m.csv`**: Records the inertial positions (X, Y, Z in meters) of each satellite over time.
    *   *Generating Command*: `cli.py triangle`
*   **`velocities_mps.csv`**: Records the inertial velocities (Vx, Vy, Vz in m/s) of each satellite over time.
    *   *Generating Command*: `cli.py triangle`
*   **`latitudes_rad.csv`**: Records the geodetic latitudes (in radians) of each satellite over time.
    *   *Generating Command*: `cli.py triangle`
*   **`longitudes_rad.csv`**: Records the geodetic longitudes (in radians) of each satellite over time.
    *   *Generating Command*: `cli.py triangle`
*   **`altitudes_m.csv`**: Records the geodetic altitudes (in meters) of each satellite over time.
    *   *Generating Command*: `cli.py triangle`
*   **`triangle_geometry.csv`**: Provides diagnostic metrics for the formation's geometry (area, aspect ratio, side lengths).
    *   *Generating Command*: `cli.py triangle`
*   **`ground_ranges.csv`**: Records the distance from the formation to the target and ground station.
    *   *Generating Command*: `cli.py triangle`
*   **`orbital_elements.csv`**: A consolidated history of the classical orbital elements for all satellites.
    *   *Generating Command*: `cli.py triangle`
*   **`maintenance_summary.csv`**: Summarizes the estimated delta-v required for station-keeping.
    *   *Generating Command*: `cli.py triangle`
*   **`command_windows.csv`**: Lists the time intervals for ground station contact.
    *   *Generating Command*: `cli.py triangle`
*   **`injection_recovery.csv`**: Results of the Monte Carlo simulation for injection error correction.
    *   *Generating Command*: `cli.py triangle`
*   **`drag_dispersion.csv`**: Results of the Monte Carlo simulation for atmospheric drag effects.
    *   *Generating Command*: `cli.py triangle`

### JSON Files

*   **`triangle_summary.json`**: A comprehensive summary of all simulation results, metrics, and configurations.
    *   *Generating Command*: `cli.py triangle`

### Plot Files (Generated in the `plots` subdirectory)

The core simulation run triggers the automatic generation of numerous plots by tools like `render_debug_plots.py` and `generate_triangle_report.py`.

*   **`plots/latitude_timeseries.svg`**: Time-series of satellite latitudes.
*   **`plots/ground_track_tehran_map.svg`**: Ground tracks plotted over a map of Tehran.
*   **`plots/formation_3d.html`**: Interactive 3D visualization of the formation.
*   **`plots/orbital_elements_timeseries.svg`**: Time-series of all classical orbital elements.
*   **`plots/triangle_geometry_timeseries.svg`**: Time-series of the triangle's geometric properties.
*   **`plots/perturbation_effects.svg`**: Visualization of long-term perturbation effects.
*   **`plots/maintenance_delta_v.svg`**: Bar chart of the annual delta-v budget.
*   ... and many others, providing a deep analysis of the simulation results.

### Directory Artefacts

*   **`orbital_elements/`**: Contains individual CSV files for each satellite's orbital elements.
    *   *Generating Command*: `cli.py triangle`
*   **`stk/`**: Contains exported files (`.e`, `.gt`, etc.) for use with AGI's Systems Tool Kit (STK).
    *   *Generating Command*: `cli.py triangle`

