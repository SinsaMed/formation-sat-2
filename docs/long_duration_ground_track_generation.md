# Long-Duration Ground Track Generation and Visualization

This document outlines the methodology for generating and visualizing long-duration ground tracks for satellite constellations, addressing the limitations of the primary `run_triangle.py` simulation script for extended propagation analysis.

## 1. Motivation for Custom Propagation

The `sim.scripts.run_triangle` script is primarily designed for detailed analysis of short-duration formation flying events around a specific epoch. While it generates ground track data, its `duration_s` parameter controls the analysis window around the initial epoch, not the total propagation time for continuous ground track visualization over many days or weeks. To accurately simulate and visualize the repeating ground track behavior over an extended period (e.g., 14 days), a dedicated long-duration propagation script is required.

## 2. Long-Duration Ground Track Propagation (`tools/propagate_long_duration.py`)

This script performs a manual, step-by-step propagation of the satellite constellation's orbit over a specified duration, logging the geodetic coordinates (latitude, longitude, altitude) at each time step. The propagation duration is dynamically determined by the `formation.duration_s` parameter within the provided scenario configuration file. It incorporates J2 secular perturbations and a simplified atmospheric drag model to provide a more realistic long-term propagation. It utilizes the orbital elements defined in a scenario configuration file.

### Usage:

```bash
python -m tools.propagate_long_duration \
    --config /path/to/scenario_config.json \
    --output-dir /path/to/output_directory \
    --time-step-s <time_step_in_seconds>
```

### Parameters:

*   `--config`: **(Required)** Path to the JSON scenario configuration file (e.g., `config/scenarios/tehran_triangle_14day.json`). This file provides the initial orbital elements, formation geometry, and **now also defines the total simulation duration via `formation.duration_s`**.
*   `--output-dir`: **(Required)** Directory where the generated ground track CSV file will be saved.
*   `--time-step-s`: **(Optional)** The time step for the propagation in seconds. Defaults to 60 seconds.

### Output:

The script generates a single CSV file named `ground_track_14day.csv` within the specified `--output-dir`. This file contains columns for `time_utc`, `satellite_id`, `latitude_deg`, `longitude_deg`, and `altitude_km` for every satellite at each time step throughout the propagation duration.

## 3. 14-Day Ground Track Visualization (`tools/render_14day_ground_track.py`)

This script takes the CSV output from `tools/propagate_long_duration.py` and generates a global map visualization of the ground tracks. It uses `matplotlib` and `cartopy` to render the Earth's features and plot the satellite paths.

### Usage:

```bash
python -m tools.render_14day_ground_track \
    --input-csv /path/to/ground_track_14day.csv \
    --output-dir /path/to/output_directory/plots
```

### Parameters:

*   `--input-csv`: **(Required)** Path to the `ground_track_14day.csv` file generated by `tools/propagate_long_duration.py`.
*   `--output-dir`: **(Required)** Directory where the generated plot image will be saved. The script will automatically create this directory if it does not exist.

### Required Libraries:

This script requires the following Python libraries:

*   `matplotlib`
*   `cartopy`
*   `pandas`

These can be installed via pip: `pip install matplotlib cartopy pandas`.

### Output:

The script produces an SVG image file named `14day_ground_track.svg` within the specified `--output-dir`. This image clearly displays the repeating ground tracks of all satellites over the 14-day period, demonstrating the effectiveness of the RGT orbit design. The output image is clean and effectively visualizes the orbital paths, as noted by user feedback.
